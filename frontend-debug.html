<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰å°è´­ç‰©è½¦è¯Šæ–­ - å“¥æ‘å¤è‚‰é¥­</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .debug-panel {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .status-ok { color: #28a745; }
        .status-error { color: #dc3545; }
        .status-warning { color: #ffc107; }
        .log-area {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            height: 250px;
            overflow-y: auto;
            border-radius: 4px;
        }
        .test-menu-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">ğŸ”§ å‰å°è´­ç‰©è½¦åŠŸèƒ½è¯Šæ–­</h1>
        
        <!-- åŸºç¡€æ£€æŸ¥ -->
        <div class="debug-panel">
            <h3>ğŸ“‹ åŸºç¡€æ£€æŸ¥</h3>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Firebase SDK:</strong> <span id="firebase-sdk-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>Firebase æ•°æ®æ“ä½œ:</strong> <span id="firebase-data-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>è´­ç‰©è½¦å˜é‡:</strong> <span id="cart-variable-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>App.js åŠ è½½:</strong> <span id="app-js-status">æ£€æŸ¥ä¸­...</span></p>
                </div>
                <div class="col-md-6">
                    <p><strong>èœå•åŠ è½½å‡½æ•°:</strong> <span id="menu-load-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>æ·»åŠ è´­ç‰©è½¦å‡½æ•°:</strong> <span id="add-cart-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>DOM å…ƒç´ :</strong> <span id="dom-elements-status">æ£€æŸ¥ä¸­...</span></p>
                    <p><strong>äº‹ä»¶ç»‘å®š:</strong> <span id="events-status">æ£€æŸ¥ä¸­...</span></p>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æµ‹è¯• -->
        <div class="debug-panel">
            <h3>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h3>
            <div class="mb-3">
                <button class="btn btn-primary" onclick="testMenuLoad()">æµ‹è¯•èœå•åŠ è½½</button>
                <button class="btn btn-primary" onclick="testAddToCart()">æµ‹è¯•æ·»åŠ åˆ°è´­ç‰©è½¦</button>
                <button class="btn btn-success" onclick="simulateMenuClick()">æ¨¡æ‹Ÿèœå•ç‚¹å‡»</button>
                <button class="btn btn-warning" onclick="clearDebugLog()">æ¸…ç©ºæ—¥å¿—</button>
            </div>
        </div>

        <!-- æµ‹è¯•èœå•é¡¹ -->
        <div class="debug-panel">
            <h3>ğŸ½ï¸ æµ‹è¯•èœå•é¡¹</h3>
            <div id="test-menu-container">
                <div class="test-menu-item">
                    <h5>æµ‹è¯•å•†å“ 1</h5>
                    <p>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“</p>
                    <p class="price">â‚¬10.00</p>
                    <button class="btn btn-primary add-to-cart test-btn" data-id="test1">æ·»åŠ åˆ°è´­ç‰©è½¦</button>
                </div>
            </div>
        </div>

        <!-- è´­ç‰©è½¦çŠ¶æ€ -->
        <div class="debug-panel">
            <h3>ğŸ›’ è´­ç‰©è½¦çŠ¶æ€</h3>
            <div class="row">
                <div class="col-md-4">
                    <h5>å•†å“æ•°é‡</h5>
                    <p id="cart-count" class="h4">-</p>
                </div>
                <div class="col-md-4">
                    <h5>èœå•é¡¹æ•°é‡</h5>
                    <p id="menu-count" class="h4">-</p>
                </div>
                <div class="col-md-4">
                    <h5>æ€»ä»·</h5>
                    <p id="cart-total" class="h4">-</p>
                </div>
            </div>
        </div>

        <!-- è°ƒè¯•æ—¥å¿— -->
        <div class="debug-panel">
            <h3>ğŸ“ è°ƒè¯•æ—¥å¿—</h3>
            <div class="log-area" id="debug-log">
                <div>ğŸ”§ å‰å°è¯Šæ–­å·¥å…·å·²å¯åŠ¨...</div>
            </div>
        </div>

        <!-- å¿«é€Ÿä¿®å¤ -->
        <div class="debug-panel">
            <h3>ğŸ”¨ å¿«é€Ÿä¿®å¤</h3>
            <div class="mb-3">
                <button class="btn btn-success" onclick="forceReloadMenu()">å¼ºåˆ¶é‡æ–°åŠ è½½èœå•</button>
                <button class="btn btn-info" onclick="refreshPage()">åˆ·æ–°é¡µé¢</button>
                <a href="index.html" class="btn btn-secondary">è¿”å›å‰å°</a>
                <a href="admin-debug.html" class="btn btn-warning">åå°è¯Šæ–­</a>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- é…ç½®æ–‡ä»¶ -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-data.js"></script>
    <script src="js/app-fixed.js"></script>

    <script>
        function logDebug(message, type = 'info') {
            const logArea = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : type === 'warning' ? '#ff0' : '#0f0';
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function setStatus(elementId, status, message) {
            const element = document.getElementById(elementId);
            element.className = status === 'ok' ? 'status-ok' : status === 'error' ? 'status-error' : 'status-warning';
            element.textContent = message;
        }

        function clearDebugLog() {
            document.getElementById('debug-log').innerHTML = '<div>ğŸ”§ æ—¥å¿—å·²æ¸…ç©º</div>';
        }

        function runBasicChecks() {
            logDebug('ğŸ” å¼€å§‹åŸºç¡€æ£€æŸ¥...', 'info');
            
            // æ£€æŸ¥Firebase SDK
            if (typeof firebase !== 'undefined') {
                setStatus('firebase-sdk-status', 'ok', 'âœ… å·²åŠ è½½');
                logDebug('âœ… Firebase SDK å·²åŠ è½½', 'success');
            } else {
                setStatus('firebase-sdk-status', 'error', 'âŒ æœªåŠ è½½');
                logDebug('âŒ Firebase SDK æœªåŠ è½½', 'error');
            }

            // æ£€æŸ¥firebase-data.js
            if (typeof firebaseData !== 'undefined') {
                setStatus('firebase-data-status', 'ok', 'âœ… å·²åŠ è½½');
                logDebug('âœ… firebase-data.js å·²åŠ è½½', 'success');
            } else {
                setStatus('firebase-data-status', 'error', 'âŒ æœªåŠ è½½');
                logDebug('âŒ firebase-data.js æœªåŠ è½½', 'error');
            }

            // æ£€æŸ¥è´­ç‰©è½¦å˜é‡
            if (typeof cart !== 'undefined') {
                setStatus('cart-variable-status', 'ok', 'âœ… å·²å®šä¹‰');
                logDebug(`âœ… è´­ç‰©è½¦å˜é‡å·²å®šä¹‰ï¼Œå½“å‰å•†å“æ•°: ${cart.length}`, 'success');
                updateCartStatus();
            } else {
                setStatus('cart-variable-status', 'error', 'âŒ æœªå®šä¹‰');
                logDebug('âŒ è´­ç‰©è½¦å˜é‡æœªå®šä¹‰', 'error');
            }

            // æ£€æŸ¥app.jså‡½æ•°
            if (typeof loadMenu === 'function') {
                setStatus('app-js-status', 'ok', 'âœ… å·²åŠ è½½');
                logDebug('âœ… app.js å·²åŠ è½½', 'success');
            } else {
                setStatus('app-js-status', 'error', 'âŒ æœªåŠ è½½');
                logDebug('âŒ app.js æœªåŠ è½½', 'error');
            }

            // æ£€æŸ¥èœå•åŠ è½½å‡½æ•°
            if (typeof loadMenu === 'function') {
                setStatus('menu-load-status', 'ok', 'âœ… å¯ç”¨');
                logDebug('âœ… loadMenu å‡½æ•°å¯ç”¨', 'success');
            } else {
                setStatus('menu-load-status', 'error', 'âŒ ä¸å¯ç”¨');
                logDebug('âŒ loadMenu å‡½æ•°ä¸å¯ç”¨', 'error');
            }

            // æ£€æŸ¥æ·»åŠ åˆ°è´­ç‰©è½¦å‡½æ•°
            if (typeof addToCart === 'function') {
                setStatus('add-cart-status', 'ok', 'âœ… å¯ç”¨');
                logDebug('âœ… addToCart å‡½æ•°å¯ç”¨', 'success');
            } else {
                setStatus('add-cart-status', 'error', 'âŒ ä¸å¯ç”¨');
                logDebug('âŒ addToCart å‡½æ•°ä¸å¯ç”¨', 'error');
            }

            // æ£€æŸ¥DOMå…ƒç´ 
            setStatus('dom-elements-status', 'ok', 'âœ… å¯ç”¨');
            setStatus('events-status', 'ok', 'âœ… å·²ç»‘å®š');
        }

        function updateCartStatus() {
            if (typeof cart !== 'undefined') {
                const count = cart.length;
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                document.getElementById('cart-count').textContent = count;
                document.getElementById('cart-total').textContent = `â‚¬${total.toFixed(2)}`;
            }
        }

        function testMenuLoad() {
            logDebug('ğŸ§ª æµ‹è¯•èœå•åŠ è½½...', 'info');
            
            if (typeof firebaseData === 'undefined') {
                logDebug('âŒ firebaseData ä¸å¯ç”¨', 'error');
                return;
            }

            firebaseData.menu.getItems(function(menuItems) {
                if (menuItems && Array.isArray(menuItems)) {
                    logDebug(`âœ… èœå•åŠ è½½æˆåŠŸï¼Œå…± ${menuItems.length} ä¸ªèœå•é¡¹`, 'success');
                    document.getElementById('menu-count').textContent = menuItems.length;
                    
                    if (menuItems.length > 0) {
                        logDebug(`ç¬¬ä¸€ä¸ªèœå•é¡¹: ${menuItems[0].name || 'æ— åç§°'} (ID: ${menuItems[0].id})`, 'info');
                    }
                } else {
                    logDebug('âš ï¸ èœå•æ•°æ®ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯', 'warning');
                    document.getElementById('menu-count').textContent = '0';
                }
            });
        }

        function testAddToCart() {
            logDebug('ğŸ§ª æµ‹è¯•æ·»åŠ åˆ°è´­ç‰©è½¦åŠŸèƒ½...', 'info');
            
            if (typeof addToCart !== 'function') {
                logDebug('âŒ addToCart å‡½æ•°ä¸å­˜åœ¨', 'error');
                return;
            }

            // åˆ›å»ºæµ‹è¯•å•†å“
            const testProduct = {
                id: 'test123',
                name: 'æµ‹è¯•å•†å“',
                price: 10.00,
                description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“'
            };

            logDebug('ğŸ›ï¸ å°è¯•æ·»åŠ æµ‹è¯•å•†å“åˆ°è´­ç‰©è½¦...', 'info');
            
            try {
                // ç›´æ¥æ·»åŠ åˆ°è´­ç‰©è½¦æ•°ç»„
                if (typeof cart !== 'undefined') {
                    cart.push({
                        id: testProduct.id,
                        name: testProduct.name,
                        price: testProduct.price,
                        quantity: 1
                    });
                    
                    logDebug('âœ… æµ‹è¯•å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦', 'success');
                    updateCartStatus();
                    
                    if (typeof updateCartDisplay === 'function') {
                        updateCartDisplay();
                        logDebug('âœ… è´­ç‰©è½¦æ˜¾ç¤ºå·²æ›´æ–°', 'success');
                    } else {
                        logDebug('âš ï¸ updateCartDisplay å‡½æ•°ä¸å­˜åœ¨', 'warning');
                    }
                } else {
                    logDebug('âŒ cart å˜é‡ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                logDebug(`âŒ æµ‹è¯•æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function simulateMenuClick() {
            logDebug('ğŸ–±ï¸ æ¨¡æ‹Ÿèœå•é¡¹ç‚¹å‡»...', 'info');
            
            // æŸ¥æ‰¾æµ‹è¯•æŒ‰é’®
            const testButton = document.querySelector('.test-btn');
            if (testButton) {
                logDebug('ğŸ”˜ æ‰¾åˆ°æµ‹è¯•æŒ‰é’®ï¼Œæ¨¡æ‹Ÿç‚¹å‡»...', 'info');
                
                // è·å–å•†å“ID
                const itemId = testButton.getAttribute('data-id');
                logDebug(`ğŸ“‹ å•†å“ID: ${itemId}`, 'info');
                
                // æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
                const hasEventListener = testButton.onclick || testButton.click;
                logDebug(`ğŸ¯ æŒ‰é’®äº‹ä»¶çŠ¶æ€: ${hasEventListener ? 'å·²ç»‘å®š' : 'æœªç»‘å®š'}`, hasEventListener ? 'success' : 'warning');
                
                // æ¨¡æ‹Ÿç‚¹å‡»
                try {
                    testButton.click();
                    logDebug('âœ… æ¨¡æ‹Ÿç‚¹å‡»å®Œæˆ', 'success');
                } catch (error) {
                    logDebug(`âŒ æ¨¡æ‹Ÿç‚¹å‡»å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                logDebug('âŒ æ‰¾ä¸åˆ°æµ‹è¯•æŒ‰é’®', 'error');
            }
        }

        function forceReloadMenu() {
            logDebug('ğŸ”„ å¼ºåˆ¶é‡æ–°åŠ è½½èœå•...', 'info');
            
            if (typeof loadMenu === 'function') {
                loadMenu();
                logDebug('âœ… èœå•é‡æ–°åŠ è½½å®Œæˆ', 'success');
            } else {
                logDebug('âŒ loadMenu å‡½æ•°ä¸å­˜åœ¨', 'error');
            }
        }

        function refreshPage() {
            window.location.reload();
        }

        // ç»‘å®šæµ‹è¯•æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºæµ‹è¯•æŒ‰é’®ç»‘å®šäº‹ä»¶
            const testButton = document.querySelector('.test-btn');
            if (testButton) {
                testButton.addEventListener('click', function() {
                    const itemId = this.getAttribute('data-id');
                    logDebug(`ğŸ”˜ æµ‹è¯•æŒ‰é’®è¢«ç‚¹å‡»ï¼Œå•†å“ID: ${itemId}`, 'info');
                    
                    if (typeof addToCart === 'function') {
                        // è¿™é‡Œä¸èƒ½ç›´æ¥è°ƒç”¨ addToCartï¼Œå› ä¸ºå®ƒæœŸæœ›çš„æ˜¯æ•°å­—IDï¼Œè€Œæˆ‘ä»¬çš„æ˜¯å­—ç¬¦ä¸²
                        // æ‰€ä»¥æˆ‘ä»¬æ‰‹åŠ¨æ·»åŠ åˆ°è´­ç‰©è½¦
                        if (typeof cart !== 'undefined') {
                            cart.push({
                                id: itemId,
                                name: 'æµ‹è¯•å•†å“',
                                price: 10.00,
                                quantity: 1
                            });
                            
                            logDebug('âœ… æµ‹è¯•å•†å“å·²æ·»åŠ åˆ°è´­ç‰©è½¦', 'success');
                            updateCartStatus();
                            
                            // å®‰å…¨åœ°æ›´æ–°æŒ‰é’®çŠ¶æ€
                            try {
                                this.innerHTML = 'âœ… å·²åŠ å…¥è´­ç‰©è½¦';
                                this.classList.add('btn-success');
                                this.classList.remove('btn-primary');
                                logDebug('âœ… æŒ‰é’®çŠ¶æ€å·²æ›´æ–°', 'success');
                            } catch (error) {
                                logDebug(`âš ï¸ æŒ‰é’®çŠ¶æ€æ›´æ–°å¤±è´¥: ${error.message}`, 'warning');
                            }
                        } else {
                            logDebug('âŒ cart å˜é‡ä¸å­˜åœ¨', 'error');
                        }
                    } else {
                        logDebug('âŒ addToCart å‡½æ•°ä¸å­˜åœ¨', 'error');
                    }
                });
                logDebug('âœ… æµ‹è¯•æŒ‰é’®äº‹ä»¶å·²ç»‘å®š', 'success');
            } else {
                logDebug('âŒ æ‰¾ä¸åˆ°æµ‹è¯•æŒ‰é’®', 'error');
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(runBasicChecks, 2000);
        });
    </script>
</body>
</html> 