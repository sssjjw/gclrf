<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯• - å“¥æ‘å¤è‚‰é¥­</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .test-section {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .log-area {
            background: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            border-radius: 4px;
            margin-top: 10px;
        }
        .cart-display {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .status { font-weight: bold; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">ğŸ›’ è´­ç‰©è½¦åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
        
        <!-- çŠ¶æ€æ£€æŸ¥ -->
        <div class="test-section">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
            <div class="row">
                <div class="col-md-3">
                    <p>Firebase: <span id="firebase-status" class="status">æ£€æŸ¥ä¸­...</span></p>
                    <p>è´­ç‰©è½¦: <span id="cart-status" class="status">æ£€æŸ¥ä¸­...</span></p>
                </div>
                <div class="col-md-3">
                    <p>èœå•æ•°æ®: <span id="menu-status" class="status">æ£€æŸ¥ä¸­...</span></p>
                    <p>æ·»åŠ åŠŸèƒ½: <span id="addcart-status" class="status">æ£€æŸ¥ä¸­...</span></p>
                </div>
                <div class="col-md-6">
                    <div class="cart-display">
                        <strong>è´­ç‰©è½¦å•†å“æ•°:</strong> <span id="cart-count">0</span><br>
                        <strong>æ€»ä»·:</strong> <span id="cart-total">â‚¬0.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•èœå• -->
        <div class="test-section">
            <h3>ğŸ½ï¸ æµ‹è¯•èœå•</h3>
            <div class="row" id="test-menu">
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">æµ‹è¯•å•†å“A</h5>
                            <p class="card-text">è¿™æ˜¯æµ‹è¯•å•†å“Açš„æè¿°</p>
                            <p class="text-primary fw-bold">â‚¬8.50</p>
                            <button class="btn btn-primary add-to-cart w-100" 
                                    data-id="test-a" 
                                    data-name="æµ‹è¯•å•†å“A" 
                                    data-price="8.50">
                                æ·»åŠ åˆ°è´­ç‰©è½¦
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">æµ‹è¯•å•†å“B</h5>
                            <p class="card-text">è¿™æ˜¯æµ‹è¯•å•†å“Bçš„æè¿°</p>
                            <p class="text-primary fw-bold">â‚¬12.00</p>
                            <button class="btn btn-primary add-to-cart w-100" 
                                    data-id="test-b" 
                                    data-name="æµ‹è¯•å•†å“B" 
                                    data-price="12.00">
                                æ·»åŠ åˆ°è´­ç‰©è½¦
                            </button>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">æµ‹è¯•å•†å“C</h5>
                            <p class="card-text">è¿™æ˜¯æµ‹è¯•å•†å“Cçš„æè¿°</p>
                            <p class="text-primary fw-bold">â‚¬15.80</p>
                            <button class="btn btn-primary add-to-cart w-100" 
                                    data-id="test-c" 
                                    data-name="æµ‹è¯•å•†å“C" 
                                    data-price="15.80">
                                æ·»åŠ åˆ°è´­ç‰©è½¦
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è´­ç‰©è½¦æ˜¾ç¤º -->
        <div class="test-section">
            <h3>ğŸ›’ è´­ç‰©è½¦å†…å®¹</h3>
            <div id="cart-items">
                <p class="text-muted">è´­ç‰©è½¦ä¸ºç©º</p>
            </div>
            <hr>
            <div class="d-flex justify-content-between">
                <strong>æ€»è®¡: <span id="total-display">â‚¬0.00</span></strong>
                <button class="btn btn-success" onclick="clearCart()">æ¸…ç©ºè´­ç‰©è½¦</button>
            </div>
        </div>

        <!-- æµ‹è¯•æŒ‰é’® -->
        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ§åˆ¶</h3>
            <button class="btn btn-info me-2" onclick="runSystemCheck()">ç³»ç»Ÿæ£€æŸ¥</button>
            <button class="btn btn-primary me-2" onclick="testDirectAdd()">ç›´æ¥æ·»åŠ æµ‹è¯•</button>
            <button class="btn btn-warning me-2" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            <a href="index.html" class="btn btn-secondary me-2">è¿”å›ä¸»é¡µ</a>
            <a href="frontend-debug.html" class="btn btn-secondary">è¯Šæ–­å·¥å…·</a>
        </div>

        <!-- æ—¥å¿— -->
        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div class="log-area" id="test-log">
                <div>ğŸ§ª è´­ç‰©è½¦æµ‹è¯•é¡µé¢å·²åŠ è½½...</div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- é…ç½®æ–‡ä»¶ -->
    <script src="js/firebase-config.js"></script>
    <script src="js/firebase-data.js"></script>
    <script src="js/app-fixed.js"></script>

    <script>
        function log(message, type = 'info') {
            const logArea = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            let color = '#0f0';
            if (type === 'error') color = '#f00';
            else if (type === 'warning') color = '#ff0';
            else if (type === 'success') color = '#0f0';
            
            logEntry.style.color = color;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function setStatus(elementId, text, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = text;
                element.className = `status ${type}`;
            }
        }

        function updateCartDisplay() {
            if (typeof cart === 'undefined') {
                log('âŒ cartå˜é‡æœªå®šä¹‰', 'error');
                return;
            }

            const cartItemsContainer = document.getElementById('cart-items');
            const cartCount = document.getElementById('cart-count');
            const cartTotal = document.getElementById('cart-total');
            const totalDisplay = document.getElementById('total-display');

            // æ›´æ–°è®¡æ•°å™¨
            const itemCount = cart.length;
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            if (cartCount) cartCount.textContent = itemCount;
            if (cartTotal) cartTotal.textContent = `â‚¬${totalPrice.toFixed(2)}`;
            if (totalDisplay) totalDisplay.textContent = `â‚¬${totalPrice.toFixed(2)}`;

            // æ›´æ–°å•†å“åˆ—è¡¨
            if (cartItemsContainer) {
                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-muted">è´­ç‰©è½¦ä¸ºç©º</p>';
                } else {
                    cartItemsContainer.innerHTML = '';
                    cart.forEach((item, index) => {
                        const itemElement = document.createElement('div');
                        itemElement.className = 'cart-item d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded';
                        itemElement.innerHTML = `
                            <div>
                                <strong>${item.name}</strong> x${item.quantity}
                                <small class="text-muted">â‚¬${item.price.toFixed(2)} æ¯ä¸ª</small>
                            </div>
                            <div>
                                <span class="me-2">â‚¬${(item.price * item.quantity).toFixed(2)}</span>
                                <button class="btn btn-sm btn-outline-danger" onclick="removeItem(${index})">åˆ é™¤</button>
                            </div>
                        `;
                        cartItemsContainer.appendChild(itemElement);
                    });
                }
            }

            log(`âœ… è´­ç‰©è½¦æ˜¾ç¤ºå·²æ›´æ–°: ${itemCount}ä»¶å•†å“, æ€»ä»·â‚¬${totalPrice.toFixed(2)}`, 'success');
        }

        function removeItem(index) {
            if (typeof cart !== 'undefined' && cart[index]) {
                const item = cart[index];
                cart.splice(index, 1);
                log(`ğŸ—‘ï¸ åˆ é™¤å•†å“: ${item.name}`, 'info');
                updateCartDisplay();
            }
        }

        function clearCart() {
            if (typeof cart !== 'undefined') {
                cart.length = 0;
                log('ğŸ§¹ è´­ç‰©è½¦å·²æ¸…ç©º', 'info');
                updateCartDisplay();
            }
        }

        function clearLogs() {
            document.getElementById('test-log').innerHTML = '<div>ğŸ“ æ—¥å¿—å·²æ¸…ç©º</div>';
        }

        function runSystemCheck() {
            log('ğŸ” å¼€å§‹ç³»ç»Ÿæ£€æŸ¥...', 'info');

            // æ£€æŸ¥Firebase
            if (typeof firebase !== 'undefined') {
                setStatus('firebase-status', 'âœ… æ­£å¸¸', 'success');
                log('âœ… Firebase SDK å·²åŠ è½½', 'success');
            } else {
                setStatus('firebase-status', 'âŒ é”™è¯¯', 'error');
                log('âŒ Firebase SDK æœªåŠ è½½', 'error');
            }

            // æ£€æŸ¥è´­ç‰©è½¦
            if (typeof cart !== 'undefined') {
                setStatus('cart-status', 'âœ… æ­£å¸¸', 'success');
                log(`âœ… è´­ç‰©è½¦å˜é‡æ­£å¸¸ï¼Œå½“å‰${cart.length}ä»¶å•†å“`, 'success');
            } else {
                setStatus('cart-status', 'âŒ é”™è¯¯', 'error');
                log('âŒ è´­ç‰©è½¦å˜é‡æœªå®šä¹‰', 'error');
            }

            // æ£€æŸ¥èœå•åŠŸèƒ½
            if (typeof firebaseData !== 'undefined' && firebaseData.menu) {
                setStatus('menu-status', 'âœ… æ­£å¸¸', 'success');
                log('âœ… èœå•æ•°æ®æœåŠ¡æ­£å¸¸', 'success');
            } else {
                setStatus('menu-status', 'âŒ é”™è¯¯', 'error');
                log('âŒ èœå•æ•°æ®æœåŠ¡ä¸å¯ç”¨', 'error');
            }

            // æ£€æŸ¥æ·»åŠ åŠŸèƒ½
            if (typeof addToCart === 'function') {
                setStatus('addcart-status', 'âœ… æ­£å¸¸', 'success');
                log('âœ… addToCartå‡½æ•°å¯ç”¨', 'success');
            } else {
                setStatus('addcart-status', 'âŒ é”™è¯¯', 'error');
                log('âŒ addToCartå‡½æ•°ä¸å¯ç”¨', 'error');
            }

            updateCartDisplay();
        }

        function testDirectAdd() {
            log('ğŸ§ª å¼€å§‹ç›´æ¥æ·»åŠ æµ‹è¯•...', 'info');
            
            if (typeof cart === 'undefined') {
                log('âŒ cartå˜é‡ä¸å­˜åœ¨ï¼Œæ— æ³•æµ‹è¯•', 'error');
                return;
            }

            // ç›´æ¥æ·»åŠ æµ‹è¯•å•†å“
            const testItem = {
                id: 'direct-test',
                name: 'ç›´æ¥æµ‹è¯•å•†å“',
                price: 9.99,
                quantity: 1
            };

            cart.push(testItem);
            log('âœ… ç›´æ¥æ·»åŠ æµ‹è¯•å•†å“æˆåŠŸ', 'success');
            updateCartDisplay();
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“± é¡µé¢DOMåŠ è½½å®Œæˆ', 'info');
            
            // ç­‰å¾…ä¸€ä¼šå„¿å†æ£€æŸ¥ç³»ç»Ÿ
            setTimeout(function() {
                runSystemCheck();
                
                // ç»‘å®šæ·»åŠ åˆ°è´­ç‰©è½¦æŒ‰é’®
                const buttons = document.querySelectorAll('.add-to-cart');
                log(`ğŸ”˜ æ‰¾åˆ°${buttons.length}ä¸ªæ·»åŠ æŒ‰é’®ï¼Œå¼€å§‹ç»‘å®šäº‹ä»¶...`, 'info');
                
                buttons.forEach((button, index) => {
                    button.addEventListener('click', function(event) {
                        event.preventDefault();
                        
                        const itemId = this.getAttribute('data-id');
                        const itemName = this.getAttribute('data-name');
                        const itemPrice = parseFloat(this.getAttribute('data-price'));
                        
                        log(`ğŸ›’ ç‚¹å‡»æ·»åŠ æŒ‰é’®: ${itemName} (ID: ${itemId}, ä»·æ ¼: â‚¬${itemPrice})`, 'info');
                        
                        // ç›´æ¥æ·»åŠ åˆ°è´­ç‰©è½¦ï¼ˆç®€åŒ–ç‰ˆï¼‰
                        if (typeof cart !== 'undefined') {
                            const existingItem = cart.find(item => item.id === itemId);
                            
                            if (existingItem) {
                                existingItem.quantity += 1;
                                log(`ğŸ“ˆ å¢åŠ æ•°é‡: ${existingItem.name} x${existingItem.quantity}`, 'success');
                            } else {
                                cart.push({
                                    id: itemId,
                                    name: itemName,
                                    price: itemPrice,
                                    quantity: 1
                                });
                                log(`â• æ–°å¢å•†å“: ${itemName}`, 'success');
                            }
                            
                            // æ›´æ–°æŒ‰é’®çŠ¶æ€
                            this.innerHTML = 'âœ… å·²æ·»åŠ ';
                            this.classList.add('btn-success');
                            this.classList.remove('btn-primary');
                            
                            updateCartDisplay();
                        } else {
                            log('âŒ cartå˜é‡ä¸å­˜åœ¨', 'error');
                        }
                    });
                });
                
                log('âœ… æŒ‰é’®äº‹ä»¶ç»‘å®šå®Œæˆ', 'success');
            }, 2000);
        });
    </script>
</body>
</html> 